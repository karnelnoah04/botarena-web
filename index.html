<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BotArena</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f0f14;
  color: #fff;
}

.header {
  padding: 16px;
  text-align: center;
  font-weight: bold;
  font-size: 18px;
}

.coupons {
  display: flex;
  justify-content: space-around;
  background: #1b1b25;
  margin: 10px;
  padding: 12px;
  border-radius: 12px;
}

.coupon {
  text-align: center;
}

.tabs {
  display: flex;
  padding: 10px;
}

.tab {
  flex: 1;
  text-align: center;
  padding: 10px;
  color: #aaa;
}

.tab.active {
  color: #fff;
  border-bottom: 2px solid #7c4dff;
}

.task {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px;
  border-bottom: 1px solid #222;
}

.task-left {
  display: flex;
  align-items: center;
}

.icon {
  width: 36px;
  height: 36px;
  border-radius: 8px;
  background: #7c4dff;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 12px;
}

.start-btn {
  background: #7c4dff;
  border: none;
  color: #fff;
  padding: 8px 16px;
  border-radius: 20px;
  cursor: pointer;
}

.nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #1b1b25;
  display: flex;
}

.nav div {
  flex: 1;
  text-align: center;
  padding: 10px;
  color: #aaa;
}
</style>
</head>

<body>

<div class="header">BotArena</div>

<div class="coupons">
  <div class="coupon">üéüÔ∏è<br>0</div>
  <div class="coupon">üéüÔ∏è<br>0</div>
  <div class="coupon">üéüÔ∏è<br>0</div>
  <div class="coupon">üéüÔ∏è<br>0</div>
</div>

<div class="tabs">
  <div class="tab active">Tasks</div>
  <div class="tab">Partners</div>
</div>

<div id="taskList"></div>
<div class="nav">
  <div>Home</div>
  <div>Quests</div>
  <div>Wallet</div>
  <div>Profile</div>
</div>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
const SUPABASE_URL = "https://jbbgsqvlnlaiabzhrmfp.supabase.co";
const SUPABASE_KEY = "sb_publishable_eld7FfHsQi48L9xS513QRQ_mi3iNmBQ";

const tg = window.Telegram.WebApp;
tg.ready();

const supabase = supabase.createClient(
  SUPABASE_URL,
  SUPABASE_KEY
);

const telegramId = tg.initDataUnsafe.user.id;

async function loadTasks() {
  const list = document.getElementById("taskList");
  list.innerHTML = "";

  const { data: tasks } = await supabase
    .from("tasks")
    .select("*")
    .eq("is_active", true);

  if (!tasks || tasks.length === 0) {
    list.innerHTML = "<p style='padding:14px'>No tasks available</p>";
    return;
  }

  tasks.forEach(t => {
    const div = document.createElement("div");
    div.className = "task";
    div.innerHTML = `
      <div class="task-left">
        <div class="icon">‚≠ê</div>
        <div>
          <div>${t.task_name}</div>
          <small>+${t.reward} AP</small>
        </div>
      </div>
      <button class="start-btn" onclick="openTask(${t.id}, '${t.url}', ${t.reward})">
        Start
      </button>
    `;
    list.appendChild(div);
  });
}

async function openTask(taskId, url, reward) {
  tg.openLink(url);

  await supabase.from("user_tasks").insert({
    telegram_id: telegramId,
    task_id: taskId,
    is_done: true,
    claimed: false
  });
}

loadTasks();
</script>
</body>
</html>